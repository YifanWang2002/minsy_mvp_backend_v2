# Minsy backend environment template
# Copy this file to .env and fill secrets/addresses for your machine.

# -----------------------------------------------------------------------------
# Runtime mode (single switch for dev/prod behavior)
# -----------------------------------------------------------------------------
# APP_ENV controls:
# 1) MCP target selection (MCP_SERVER_URL_DEV vs MCP_SERVER_URL_PROD)
# 2) CORS strategy (dev/test: allow all origins; prod: use CORS_ORIGINS)
APP_ENV=dev

# -----------------------------------------------------------------------------
# App and server
# -----------------------------------------------------------------------------
APP_NAME=Minsy
DEBUG=true
API_V1_PREFIX=/api/v1
HOST=0.0.0.0
PORT=8000
LOG_LEVEL=INFO
CHAT_DEBUG_TRACE_ENABLED=false
CHAT_DEBUG_TRACE_MODE=compact

# -----------------------------------------------------------------------------
# OpenAI + MCP
# -----------------------------------------------------------------------------
OPENAI_API_KEY=<your_openai_api_key>
OPENAI_RESPONSE_MODEL=gpt-5.2
MCP_SERVER_URL_DEV=https://dev.minsyai.com/mcp
MCP_SERVER_URL_PROD=https://mcp.minsyai.com/mcp
# Optional: domain-specific MCP URLs. If empty, each domain falls back to
# MCP_SERVER_URL_DEV/MCP_SERVER_URL_PROD automatically.
MCP_SERVER_URL_STRATEGY_DEV=https://dev.minsyai.com/strategy/mcp
MCP_SERVER_URL_STRATEGY_PROD=https://mcp.minsyai.com/strategy/mcp
MCP_SERVER_URL_BACKTEST_DEV=https://dev.minsyai.com/backtest/mcp
MCP_SERVER_URL_BACKTEST_PROD=https://mcp.minsyai.com/backtest/mcp
MCP_SERVER_URL_MARKET_DATA_DEV=https://dev.minsyai.com/market/mcp
MCP_SERVER_URL_MARKET_DATA_PROD=https://mcp.minsyai.com/market/mcp
MCP_SERVER_URL_STRESS_DEV=https://dev.minsyai.com/stress/mcp
MCP_SERVER_URL_STRESS_PROD=https://mcp.minsyai.com/stress/mcp
MCP_SERVER_URL_TRADING_DEV=https://dev.minsyai.com/trading/mcp
MCP_SERVER_URL_TRADING_PROD=https://mcp.minsyai.com/trading/mcp
# Optional: local reverse-proxy upstreams for `python -m src.mcp.dev_proxy`.
MCP_PROXY_UPSTREAM_STRATEGY=http://127.0.0.1:8111
MCP_PROXY_UPSTREAM_BACKTEST=http://127.0.0.1:8112
MCP_PROXY_UPSTREAM_MARKET=http://127.0.0.1:8113
MCP_PROXY_UPSTREAM_STRESS=http://127.0.0.1:8114
MCP_PROXY_UPSTREAM_TRADING=http://127.0.0.1:8115
MCP_PROXY_UPSTREAM_LEGACY=http://127.0.0.1:8111
MCP_CONTEXT_SECRET=
MCP_CONTEXT_TTL_SECONDS=300
TELEGRAM_ENABLED=true
TELEGRAM_BOT_TOKEN=
TELEGRAM_BOT_USERNAME=
TELEGRAM_WEBHOOK_SECRET_TOKEN=
TELEGRAM_CONNECT_TTL_SECONDS=600

# -----------------------------------------------------------------------------
# Alpaca (paper-trading integration)
# -----------------------------------------------------------------------------
# Required for upcoming Alpaca execution/data modules:
ALPACA_API_KEY=
ALPACA_API_SECRET=
# Keep paper endpoint by default. Switch to live endpoint only when live trading
# is explicitly enabled in runtime logic:
ALPACA_TRADING_BASE_URL=https://paper-api.alpaca.markets
ALPACA_MARKET_DATA_BASE_URL=https://data.alpaca.markets
# Data feed defaults for MVP:
ALPACA_STOCKS_FEED=iex
ALPACA_CRYPTO_FEED=us

# -----------------------------------------------------------------------------
# PostgreSQL
# -----------------------------------------------------------------------------
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=123456
POSTGRES_DB=minsy_pgsql
POSTGRES_POOL_SIZE=10
POSTGRES_MAX_OVERFLOW=20
SQLALCHEMY_ECHO=false

# -----------------------------------------------------------------------------
# Redis + Celery
# -----------------------------------------------------------------------------
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_MAX_CONNECTIONS=50
CELERY_BROKER_URL=
CELERY_RESULT_BACKEND=
CELERY_TASK_DEFAULT_QUEUE=backtest
CELERY_TASK_TIME_LIMIT_SECONDS=1800
CELERY_TASK_SOFT_TIME_LIMIT_SECONDS=1740
CELERY_WORKER_MAX_MEMORY_PER_CHILD=524288
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_TASK_ACKS_LATE=true
CELERY_TASK_ALWAYS_EAGER=false
CELERY_TIMEZONE=UTC

# -----------------------------------------------------------------------------
# Maintenance jobs
# -----------------------------------------------------------------------------
POSTGRES_BACKUP_ENABLED=true
POSTGRES_BACKUP_DIR=backups/postgres
POSTGRES_BACKUP_RETENTION_COUNT=14
POSTGRES_BACKUP_HOUR_UTC=3
POSTGRES_BACKUP_MINUTE_UTC=0
POSTGRES_PG_DUMP_BIN=pg_dump
USER_EMAIL_CSV_EXPORT_ENABLED=true
USER_EMAIL_CSV_PATH=exports/user_emails.csv
USER_EMAIL_CSV_EXPORT_INTERVAL_MINUTES=60

# -----------------------------------------------------------------------------
# CORS (used only when APP_ENV=prod)
# -----------------------------------------------------------------------------
CORS_ORIGINS=["https://app.minsyai.com","https://dev.minsyai.com"]
# Optional regex (also applied in prod) for dynamic localhost ports.
CORS_ORIGIN_REGEX=^http://(localhost|127\.0\.0\.1)(:\d+)?$

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
SECRET_KEY=<jwt_secret>
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
REFRESH_TOKEN_EXPIRE_DAYS=7
AUTH_RATE_LIMIT=30
AUTH_RATE_WINDOW=60
